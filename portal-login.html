<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Login - MCK Kariokor School</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="CSS/School.css">
</head>
<body>
    <!-- Header Navigation -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="Index.html">
                <img src="Images/Logo1.jpg" alt="MCK Kariokor School Badge" class="img-fluid">
                <div class="navbar-tagline">REALIZING FULL POTENTIAL</div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">About Us</a>
                        <div class="dropdown-menu">
                            <img src="https://cdn.pixabay.com/photo/2017/07/31/11/21/people-2557399_960_720.jpg" alt="School Building" class="dropdown-img">
                            <a class="dropdown-item" href="School History.html">School History & Overview</a>
                            <a class="dropdown-item" href="Leadership.html">Leadership</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Academics</a>
                        <div class="dropdown-menu">
                            <img src="https://cdn.pixabay.com/photo/2016/11/14/05/21/children-1822688_960_720.jpg" alt="Students Learning" class="dropdown-img">
                            <a class="dropdown-item" href="curriculum-overview.html">Curriculum Overview</a>
                            <a class="dropdown-item" href="school-levels.html">School Sections/Levels</a>
                            <a class="dropdown-item" href="co-curricular.html">Co-curricular Integration</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Fees & Payment</a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="school-fees.html">Fee Structure</a>
                            <a class="dropdown-item" href="financial-policies.html">Financial Policies</a>
                            <a class="dropdown-item" href="support-enquiries.html">Support & Enquiries</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Portal</a>
                        <div class="dropdown-menu">
                            <img src="https://cdn.pixabay.com/photo/2018/09/04/10/27/learn-3653430_960_720.jpg" alt="Student Portal" class="dropdown-img">
                            <a class="dropdown-item" href="portal-login.html">Student Portal</a>
                            <a class="dropdown-item" href="portal-login.html">Teacher Portal</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header text-center">
        <h1>Portal Login</h1>
        <p>Access your student or teacher portal</p>
    </section>

    <!-- Login Section -->
    <section class="py-5" style="min-height: 500px;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="login-card">
                        <h2 class="text-center mb-4">Portal Access</h2>
                        
                        <div class="login-tabs row mb-4">
                            <div class="col-6 login-tab active" data-target="student-login-form">
                                Student Login
                            </div>
                            <div class="col-6 login-tab" data-target="teacher-login-form">
                                Teacher Login
                            </div>
                        </div>
                        
                        <form id="student-login-form" class="login-form">
                            <input type="hidden" name="role" value="student">
                            <div class="mb-3">
                                <label for="student-username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="student-username" name="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="student-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="student-password" name="password" required>
                            </div>
                            <div id="login-error" class="login-error"></div>
                            <button type="submit" class="btn btn-primary w-100">
                                Login
                                <span class="spinner-border spinner-border-sm form-spinner" role="status"></span>
                            </button>
                        </form>
                        
                        <form id="teacher-login-form" class="login-form" style="display: none;">
                            <input type="hidden" name="role" value="teacher">
                            <div class="mb-3">
                                <label for="teacher-username" class="form-label">Username</label>
                                <input type="text" class="form-control" id="teacher-username" name="username" required>
                            </div>
                            <div class="mb-3">
                                <label for="teacher-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="teacher-password" name="password" required>
                            </div>
                            <div id="login-error-teacher" class="login-error"></div>
                            <button type="submit" class="btn btn-primary w-100">
                                Login
                                <span class="spinner-border spinner-border-sm form-spinner" role="status"></span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <img src="Images/Logo1.jpg" alt="School Badge" class="footer-logo mb-3">
                    <p>We pride ourselves in being a leading institution of learning and offering holistic growth.</p>
                </div>
                
                <div class="col-md-4 mb-4 mb-md-0">
                    <h4 class="mb-4">Reception Contact</h4>
                    <ul class="contact-info">
                        <li><i class="fas fa-phone"></i> +254 712 345 678</li>
                        <li><i class="fas fa-envelope"></i> info@mckkariokor.ac.ke</li>
                        <li><i class="fas fa-map-marker-alt"></i> P.O. Box 12345-00100, Nairobi</li>
                    </ul>
                </div>
                
                <div class="col-md-4">
                    <h4 class="mb-4">Finance Office</h4>
                    <ul class="contact-info">
                        <li><i class="fas fa-phone"></i> +254 723 456 789</li>
                        <li><i class="fas fa-envelope"></i> finance@mckkariokor.ac.ke</li>
                        <li><i class="fas fa-clock"></i> Mon-Fri: 8:00 AM - 4:00 PM</li>
                    </ul>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2025 MCK Kariokor Primary and Junior Secondary School. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script id="app-script">
        document.addEventListener('DOMContentLoaded', function() {
            // Portal login tabs functionality
            const loginTabs = document.querySelectorAll('.login-tab');
            const loginForms = document.querySelectorAll('.login-form');
            
            if (loginTabs.length > 0) {
                loginTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const target = this.getAttribute('data-target');
                        
                        // Update active tab
                        loginTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Show selected form
                        loginForms.forEach(form => {
                            form.style.display = 'none';
                        });
                        document.getElementById(target).style.display = 'block';
                    });
                });
            }
            
            // Handle login form submissions with ValidateCredentials loop
            const forms = document.querySelectorAll('form');
            if (forms.length > 0) {
                forms.forEach(form => {
                    form.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        
                        const formType = this.getAttribute('id');
                        const username = this.querySelector('[name="username"]').value.trim();
                        const password = this.querySelector('[name="password"]').value.trim();
                        const role = this.querySelector('[name="role"]').value;
                        
                        if (!username || !password) {
                            showLoginError(formType === 'student-login-form' ? 'login-error' : 'login-error-teacher', 
                                          'Username and password are required');
                            return;
                        }
                        
                        // Show spinner
                        const spinner = this.querySelector('.form-spinner');
                        const submitBtn = this.querySelector('button[type="submit"]');
                        spinner.style.display = 'inline-block';
                        submitBtn.disabled = true;
                        
                        try {
                            const response = await fetch('https://magicloops.dev/api/loop/1349f4c6-ee13-4ba9-b0ca-e28f4a1b26cc/run', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    username: username,
                                    password: password,
                                    role: role
                                }),
                            });
                            
                            const responseData = await response.json();
                            
                            // Hide spinner
                            spinner.style.display = 'none';
                            submitBtn.disabled = false;
                            
                            if (response.ok) {
                                // Store user info in localStorage
                                localStorage.setItem('user', JSON.stringify({
                                    username: username,
                                    role: role,
                                    loggedIn: true
                                }));
                                
                                // Redirect based on role
                                if (role === 'student') {
                                    window.location.href = 'student-dashboard.html';
                                } else if (role === 'teacher') {
                                    window.location.href = 'teacher-dashboard.html';
                                }
                            } else {
                                showLoginError(formType === 'student-login-form' ? 'login-error' : 'login-error-teacher',
                                              'Invalid username or password');
                            }
                        } catch (error) {
                            console.error('Login error:', error);
                            spinner.style.display = 'none';
                            submitBtn.disabled = false;
                            showLoginError(formType === 'student-login-form' ? 'login-error' : 'login-error-teacher',
                                           'An error occurred during login. Please try again.');
                        }
                    });
                });
            }
            
            function showLoginError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 5000);
            }
        });
    </script>
</body>
</html>
